import{j as $,U as ne,V as oe,r as V,A as Y,W as ae,X as ie,Y as re,Z as W,_ as K,p as N,i as z,a as E,b as R,o as M,f as P,e as S,d as f,w as g,g as j,u as w,F as Q,m as le,$ as G,a0 as q,E as U,t as ue,k as se,T as de}from"./index-BvHamNfy.js";import{_ as ce}from"./_plugin-vue_export-helper-DlAUqK2U.js";var fe=["onActivate","onAddUndo","onBeforeAddUndo","onBeforeExecCommand","onBeforeGetContent","onBeforeRenderUI","onBeforeSetContent","onBeforePaste","onBlur","onChange","onClearUndos","onClick","onContextMenu","onCopy","onCut","onDblclick","onDeactivate","onDirty","onDrag","onDragDrop","onDragEnd","onDragGesture","onDragOver","onDrop","onExecCommand","onFocus","onFocusIn","onFocusOut","onGetContent","onHide","onInit","onKeyDown","onKeyPress","onKeyUp","onLoadContent","onMouseDown","onMouseEnter","onMouseLeave","onMouseMove","onMouseOut","onMouseOver","onMouseUp","onNodeChange","onObjectResizeStart","onObjectResized","onObjectSelected","onPaste","onPostProcess","onPostRender","onPreProcess","onProgressState","onRedo","onRemove","onReset","onSaveContent","onSelectionChange","onSetAttrib","onSetContent","onShow","onSubmit","onUndo","onVisualAid"],pe=function(e){return fe.map(function(l){return l.toLowerCase()}).indexOf(e.toLowerCase())!==-1},me=function(e,l,a){Object.keys(l).filter(pe).forEach(function(i){var o=l[i];typeof o=="function"&&(i==="onInit"?o(e,a):a.on(i.substring(2),function(p){return o(p,a)}))})},ge=function(e,l,a,i){var o=e.modelEvents?e.modelEvents:null,p=Array.isArray(o)?o.join(" "):o;$(i,function(m,y){a&&typeof m=="string"&&m!==y&&m!==a.getContent({format:e.outputFormat})&&a.setContent(m)}),a.on(p||"change input undo redo",function(){l.emit("update:modelValue",a.getContent({format:e.outputFormat}))})},ve=function(e,l,a,i,o,p){i.setContent(p()),a.attrs["onUpdate:modelValue"]&&ge(l,a,i,o),me(e,a.attrs,i)},J=0,ee=function(e){var l=Date.now(),a=Math.floor(Math.random()*1e9);return J++,e+"_"+a+J+String(l)},ye=function(e){return e!==null&&e.tagName.toLowerCase()==="textarea"},X=function(e){return typeof e>"u"||e===""?[]:Array.isArray(e)?e:e.split(" ")},he=function(e,l){return X(e).concat(X(l))},Ce=function(e){return e==null},Z=function(){return{listeners:[],scriptId:ee("tiny-script"),scriptLoaded:!1}},be=function(){var e=Z(),l=function(o,p,m,y){var d=p.createElement("script");d.referrerPolicy="origin",d.type="application/javascript",d.id=o,d.src=m;var b=function(){d.removeEventListener("load",b),y()};d.addEventListener("load",b),p.head&&p.head.appendChild(d)},a=function(o,p,m){e.scriptLoaded?m():(e.listeners.push(m),o.getElementById(e.scriptId)||l(e.scriptId,o,p,function(){e.listeners.forEach(function(y){return y()}),e.scriptLoaded=!0}))},i=function(){e=Z()};return{load:a,reinitialize:i}},_e=be(),xe=function(){return typeof window<"u"?window:global},A=function(){var e=xe();return e&&e.tinymce?e.tinymce:null},Se={apiKey:String,cloudChannel:String,id:String,init:Object,initialValue:String,inline:Boolean,modelEvents:[String,Array],plugins:[String,Array],tagName:String,toolbar:[String,Array],modelValue:String,disabled:Boolean,tinymceScriptSrc:String,outputFormat:{type:String,validator:function(e){return e==="html"||e==="text"}}},B=function(){return B=Object.assign||function(e){for(var l,a=1,i=arguments.length;a<i;a++){l=arguments[a];for(var o in l)Object.prototype.hasOwnProperty.call(l,o)&&(e[o]=l[o])}return e},B.apply(this,arguments)},we=function(e,l,a,i){return e(i||"div",{id:l,ref:a})},Be=function(e,l,a){return e("textarea",{id:l,visibility:"hidden",ref:a})},F={selector:void 0,target:void 0},Ee=ne({props:Se,setup:function(e,l){var a=e.init?B(B({},e.init),F):B({},F),i=oe(e),o=i.disabled,p=i.modelValue,m=i.tagName,y=V(null),d=null,b=e.id||ee("tiny-vue"),r=e.init&&e.init.inline||e.inline,I=!!l.attrs["onUpdate:modelValue"],_=!0,O=e.initialValue?e.initialValue:"",k="",D=function(u){return I?function(){return p?.value?p.value:""}:function(){return u?O:k}},T=function(){var u=D(_),t=B(B({},a),{readonly:e.disabled,target:y.value,plugins:he(a.plugins,e.plugins),toolbar:e.toolbar||a.toolbar,inline:r,setup:function(n){d=n,n.on("init",function(c){return ve(c,e,l,n,p,u)}),typeof a.setup=="function"&&a.setup(n)}});ye(y.value)&&(y.value.style.visibility=""),A().init(t),_=!1};$(o,function(u){var t;d!==null&&(typeof((t=d.mode)===null||t===void 0?void 0:t.set)=="function"?d.mode.set(u?"readonly":"design"):d.setMode(u?"readonly":"design"))}),$(m,function(u){var t;I||(k=d.getContent()),(t=A())===null||t===void 0||t.remove(d),K(function(){return T()})}),Y(function(){if(A()!==null)T();else if(y.value&&y.value.ownerDocument){var u=e.cloudChannel?e.cloudChannel:"6",t=e.apiKey?e.apiKey:"no-api-key",n=Ce(e.tinymceScriptSrc)?"https://cdn.tiny.cloud/1/".concat(t,"/tinymce/").concat(u,"/tinymce.min.js"):e.tinymceScriptSrc;_e.load(y.value.ownerDocument,n,T)}}),ae(function(){A()!==null&&A().remove(d)}),r||(ie(function(){_||T()}),re(function(){var u;I||(k=d.getContent()),(u=A())===null||u===void 0||u.remove(d)}));var L=function(u){var t;k=d.getContent(),(t=A())===null||t===void 0||t.remove(d),a=B(B(B({},a),u),F),K(function(){return T()})};return l.expose({rerender:L,getEditor:function(){return d}}),function(){return r?we(W,b,y,e.tagName):Be(W,b,y)}}});const Te={key:0,id:"fade",class:"black_overlay"},Ve={id:"light",class:"white_content"},ke={class:"test"},De={class:"cropper-control"},Ie={style:{height:"380px","margin-top":"20px"}},Ae={key:0,style:{"margin-top":"10px"}},Me=["src"],je=["v-html"],Oe={__name:"Cropper",setup(e,{expose:l}){const a=N("axios"),i=z({img:"",fixedBox:!0,canMoveBox:!1,fixedNumber:[373,207],outputSize:1,outputType:"jpeg",autoCrop:!0,autoCropWidth:373,autoCropHeight:207,infoTrue:!0,original:!0,centerBox:!0,enlarge:1}),o=z({file:null,f:null,innerHTML:"",freshCropper:!0,thumbnail:"",isEditor:!1});function p(t){o.file=t.target.files[0];const n={name:o.file.name,size:o.file.size,file:o.file};m(o.file),o.f=n,o.isEditor=!1,document.getElementById("fade").style.display="block",document.getElementById("upload2").value=""}function m(t,n){const c=new FileReader;c.onload=s=>{i.img=s.target.result},c.readAsDataURL(t)}function y(){document.getElementById("fade").style.display="none"}const d=V(null);let b=V(0);function r(t){d.value.getCropData(n=>{let c=I(n,o.file.name),s=new FormData;s.append("file",c.file,c.name);let x={headers:{"Content-Type":"multipart/form-data"}};a.post("/api/article/upload",s,x).then(v=>{if(v.status===200)try{var C=document.getElementById("text");o.thumbnail=v.data.map.url,C.focus();var h=b.value,H=window.getSelection();h&&(H.removeAllRanges(),H.addRange(h)),document.execCommand("InsertImage",!1,o.thumbnail),b.value=H.getRangeAt(0)}catch(te){console.log("捕获到异常：",te)}else console.log("失败400")}),document.getElementById("fade").style.display="none"})}function I(t,n){for(var c=t.split(","),s=c[0].match(/:(.*?);/)[1],x=atob(c[1]),v=x.length,C=new Uint8Array(v);v--;)C[v]=x.charCodeAt(v);let h=new Blob([C],{type:s});return h.lastModeifiedDate=new Date,h.name=n,{file:h,name:n}}function _(){var t=window.getSelection();b.value=t.getRangeAt(0)}function O(){d.value.rotateRight()}function k(t){o.innerHTML=t.target.innerHTML}const D=N("freshCropper"),T=()=>o.thumbnail;function L(){o.thumbnail="",D()}function u(t){o.thumbnail=t,o.isEditor=!0}return l({getThumbnail:T,clearData:L,setThumbnail:u}),(t,n)=>{const c=E("VueCropper"),s=E("el-button"),x=E("el-col"),v=E("el-row"),C=E("el-space");return M(),R(Q,null,[o.freshCropper?(M(),R("div",Te,[S("div",Ve,[S("div",ke,[f(c,{ref_key:"myCropper",ref:d,img:i.img,fixedBox:i.fixedBox,canMoveBox:i.canMoveBox,fixedNumber:i.fixedNumber,outputSize:i.size,outputType:i.outputType,infoTrue:i.infoTrue,autoCrop:i.autoCrop,autoCropWidth:i.autoCropWidth,autoCropHeight:i.autoCropHeight,centerBox:i.centerBox,original:i.original,enlarge:i.enlarge},null,8,["img","fixedBox","canMoveBox","fixedNumber","outputSize","outputType","infoTrue","autoCrop","autoCropWidth","autoCropHeight","centerBox","original","enlarge"])]),S("div",De,[f(v,{justify:"end"},{default:g(()=>[f(x,{span:24},{default:g(()=>[n[10]||(n[10]=S("span",{style:{"margin-right":"10px"}},"滚动鼠标滚轮可以缩放图片",-1)),f(s,{type:"primary",onClick:n[0]||(n[0]=h=>y())},{default:g(()=>[...n[7]||(n[7]=[j("取消",-1)])]),_:1}),f(s,{type:"primary",onClick:n[1]||(n[1]=h=>r(h))},{default:g(()=>[...n[8]||(n[8]=[j("确定",-1)])]),_:1}),f(s,{type:"primary",onClick:n[2]||(n[2]=h=>O())},{default:g(()=>[...n[9]||(n[9]=[j("向右边旋转90度",-1)])]),_:1})]),_:1})]),_:1})])])])):P("",!0),S("div",Ie,[f(C,{size:30},{default:g(()=>[n[12]||(n[12]=S("label",{class:"btn-photo",for:"upload2"},"选择文章标题图片(可以不设置，使用默认值)",-1)),S("input",{ref:"upload",type:"file",id:"upload2",style:{position:"absolute",clip:"rect(0 0 0 0)"},accept:"image/png, image/jpeg, image/gif, image/jpg",onChange:n[3]||(n[3]=h=>p(h))},null,544),f(s,{type:"primary",onClick:w(D)},{default:g(()=>[...n[11]||(n[11]=[j("清空图片",-1)])]),_:1},8,["onClick"])]),_:1}),o.isEditor?(M(),R("div",Ae,[S("img",{src:o.thumbnail},null,8,Me)])):P("",!0),o.isEditor?P("",!0):(M(),R("div",{key:1,ref:"cTextareaRef",contenteditable:"true",class:"textdiv",id:"text",onClick:n[4]||(n[4]=h=>_()),onOnkeyup:n[5]||(n[5]=h=>_()),"v-html":o.innerHTML,onBlur:n[6]||(n[6]=h=>k(h))},null,40,je))])],64)}}},Le=ce(Oe,[["__scopeId","data-v-cf52aaff"]]),Re={id:"editor"},Ue={align:"right"},ze={__name:"PublishArticle",setup(e){const l=le();let a="add";const i=V("发布文章"),o=N("axios"),p=V([]),m=V([]),y=(u,t)=>new Promise((n,c)=>{const s=new XMLHttpRequest;s.withCredentials=!1,s.open("POST","/api/article/upload"),s.upload.onprogress=v=>{t(v.loaded/v.total*100)},s.onload=()=>{if(s.status===403){c({message:"HTTP Error: "+s.status,remove:!0});return}if(s.status<200||s.status>=300){c("HTTP Error: "+s.status);return}const v=JSON.parse(s.response);if(!v||!v.map||typeof v.map.url!="string"){c("Invalid JSON: "+s.responseText);return}n(v.map.url)},s.onerror=()=>{c("Image upload failed. Code: "+s.status)};const x=new FormData;x.append("file",u.blob(),u.filename()),s.send(x)}),d=V("bdddx89zynvfw2qmzfk2mhycdiss6ujej1hkf49al3p0omcc"),b=z({language:"zh_CN",placeholder:"在这里输入文字",plugins:["image","code"],toolbar:"image",images_file_types:"jpg,jpeg,png,gif,bmp",images_upload_handler:y,convert_urls:!1});let r=z({title:"",tags:"",content:"",categories:"",thumbnail:""});function I(){o.get("/api/category/getTree").then(u=>{u.data.success&&(p.value=u.data.map.data)})}Y(()=>{I(),l.articleId>0&&(a="edit",i.value="编辑文章",o({method:"post",url:"/api/article/selectById?id="+l.articleId}).then(u=>{if(u.data.success){let t=u.data.map.article;r.id=t.id,r.title=t.title,r.tags=t.tags,r.content=t.content,r.thumbnail=t.thumbnail,t.categories&&(r.categories=t.categories,m.value=t.categories.split("/")),!G(r.thumbnail)&&!q(r.thumbnail)&&r.thumbnail.indexOf("/api")==0&&_.value.setThumbnail(r.thumbnail)}else U.alert(u.data.msg,"结果");l.articleId=0}).catch(u=>{U.alert("系统错误！","结果"),l.articleId=0}))});const _=V(null);function O(){let u=_.value.getThumbnail();if(G(u)||q(u)||u.indexOf("/api")!=0?r.thumbnail="":r.thumbnail=u,m.value&&m.value.length>0?r.categories=m.value.join("/"):r.categories="默认分类",r.tags){let n=r.tags.replace(/，/g," ").replace(/,/g," ").trim().split(/\s+/);r.tags=n.map(c=>c.startsWith("#")?c:"#"+c).join(" ")}o({method:"post",url:"/api/article/publishArticle?type="+a,data:r,timeout:3e6}).then(t=>{U.alert(t.data,"结果"),t.data=="添加成功！"&&(L(),window.scrollTo(0,0))}).catch(t=>{U.alert("系统错误！","结果")})}const k=N("gotoArticleManage");let D=V(!0);function T(){D.value=!1,K(()=>{D.value=!0})}de("freshCropper",T);function L(){r.title="",r.tags="",r.content="",r.categories="",m.value=[],r.thumbnail="",_.value.clearData()}return(u,t)=>{const n=E("el-col"),c=E("el-row"),s=E("el-input"),x=E("el-cascader"),v=E("el-button");return M(),R(Q,null,[f(c,null,{default:g(()=>[f(n,{span:24},{default:g(()=>[S("h4",null,ue(i.value),1)]),_:1})]),_:1}),f(c,{gutter:20,style:{"margin-bottom":"20px"}},{default:g(()=>[f(n,{span:8},{default:g(()=>[f(s,{modelValue:w(r).title,"onUpdate:modelValue":t[0]||(t[0]=C=>w(r).title=C),placeholder:"请输入文章标题（必须）",clearable:""},null,8,["modelValue"])]),_:1}),f(n,{span:8},{default:g(()=>[f(x,{modelValue:m.value,"onUpdate:modelValue":t[1]||(t[1]=C=>m.value=C),options:p.value,props:{checkStrictly:!0,value:"name",label:"name"},placeholder:"请选择文章分类",clearable:"",style:{width:"100%"}},null,8,["modelValue","options"])]),_:1}),f(n,{span:8},{default:g(()=>[f(s,{modelValue:w(r).tags,"onUpdate:modelValue":t[2]||(t[2]=C=>w(r).tags=C),placeholder:"标签: #Java #Spring (空格隔开)",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),f(c,null,{default:g(()=>[f(n,{span:24},{default:g(()=>[S("div",Re,[f(w(Ee),{modelValue:w(r).content,"onUpdate:modelValue":t[3]||(t[3]=C=>w(r).content=C),init:b,"api-key":d.value},null,8,["modelValue","init","api-key"])])]),_:1})]),_:1}),f(c,null,{default:g(()=>[f(n,{span:24},{default:g(()=>[w(D)?(M(),se(Le,{key:0,ref_key:"cropper1",ref:_},null,512)):P("",!0)]),_:1})]),_:1}),f(c,null,{default:g(()=>[f(n,{span:24},{default:g(()=>[S("div",Ue,[f(v,{onClick:w(k)},{default:g(()=>[...t[4]||(t[4]=[j("返回列表",-1)])]),_:1},8,["onClick"]),f(v,{type:"primary",onClick:O},{default:g(()=>[...t[5]||(t[5]=[j("保存文章",-1)])]),_:1})])]),_:1})]),_:1})],64)}}};export{ze as default};
