import{i as M,r as U,b as C,d as o,k as w,f as z,w as n,a as i,u as r,F as Y,p as j,J as _,o as d,e as s,a3 as L,t as p,g as m,a4 as O,a2 as I}from"./index-DSKI6YI0.js";import{_ as J}from"./_plugin-vue_export-helper-DlAUqK2U.js";const q={style:{"margin-left":"10px",display:"flex","align-items":"center",gap:"10px"}},G={style:{display:"flex","align-items":"flex-start",gap:"5px"}},H={key:1},K=["onClick"],Q={key:1},W={style:{"text-align":"center"}},X={class:"dialog-footer"},Z={__name:"ManageComment",setup(ee){const P=j("axios");let t=M({comments:[],pageParams:{page:1,rows:10,total:0,author:""},isFilterMode:!1,filterAuthor:""});function F(l){return!l||!Array.isArray(l)?[]:l.map(e=>(!e.articleId&&e.article_id&&(e.articleId=e.article_id),e.articleTitle?e.targetName=e.articleTitle:e.title&&(e.targetName=e.title),!e.targetName&&e.articleTitle&&(e.targetName=e.articleTitle),e))}function c(){P.post("/api/comment/getAdminPage",t.pageParams).then(l=>{l.data.success?(t.comments=F(l.data.map.comments||[]),l.data.map.pageParams&&(t.pageParams.total=l.data.map.pageParams.total)):(t.comments=[],_.warning(l.data.msg||"获取数据失败"))}).catch(()=>_.error("系统错误"))}function k(l){t.isFilterMode=!0,t.filterAuthor=l,t.pageParams.author=l,t.pageParams.page=1,c()}function N(){t.isFilterMode=!1,t.filterAuthor="",t.pageParams.author="",t.pageParams.page=1,c()}c();function A(l){t.isFilterMode||(t.pageParams.rows=l,t.pageParams.page=1,c())}function D(l){t.pageParams.page=l,c()}const f=U(!1);let u=M({id:0,type:"COMMENT"});function E(l){u.id=l.id,u.type=l.type||"COMMENT",f.value=!0}function T(){let l="/api/comment/deleteById?id="+u.id;u.type==="REPLY"&&(l="/api/reply/deleteById?id="+u.id),P.post(l).then(e=>{e.data.success?(_.success("删除成功"),f.value=!1,t.isFilterMode?k(t.filterAuthor):c()):_.error(e.data.msg)}).catch(()=>_.error("删除失败"))}return(l,e)=>{const y=i("el-button"),h=i("el-col"),x=i("el-row"),g=i("el-table-column"),V=i("el-tag"),b=i("router-link"),v=i("el-icon"),B=i("el-table"),$=i("el-pagination"),R=i("el-dialog");return d(),C(Y,null,[o(x,null,{default:n(()=>[o(h,{span:24},{default:n(()=>[s("h4",q,[r(t).isFilterMode?(d(),w(y,{key:0,icon:r(L),circle:"",size:"small",onClick:N,title:"返回所有评论"},null,8,["icon"])):z("",!0),s("span",null,p(r(t).isFilterMode?`用户 "${r(t).filterAuthor}" 的所有评论`:"评论管理"),1)])]),_:1})]),_:1}),o(x,null,{default:n(()=>[o(h,{span:24},{default:n(()=>[o(B,{data:r(t).comments,stripe:"",border:"",style:{width:"100%"}},{default:n(()=>[o(g,{prop:"id",label:"ID",width:"70",align:"center"}),o(g,{label:"评论内容","min-width":"300"},{default:n(a=>[s("div",G,[o(V,{size:"small",type:a.row.type==="REPLY"?"warning":"success",effect:"plain"},{default:n(()=>[m(p(a.row.type==="REPLY"?"回复":"评论"),1)]),_:2},1032,["type"]),a.row.articleId?(d(),w(b,{key:0,to:{name:"articleAndComment",params:{articleId:a.row.articleId}},class:"content-link",title:"点击前往文章详情"},{default:n(()=>[m(p(a.row.content),1)]),_:2},1032,["to"])):(d(),C("span",H,p(a.row.content),1))])]),_:1}),o(g,{label:"发布人",width:"130",align:"center"},{default:n(a=>[s("span",{class:"author-link",onClick:S=>k(a.row.author),title:"点击筛选该用户"},p(a.row.author),9,K)]),_:1}),o(g,{label:"所属文章",width:"220","show-overflow-tooltip":!0},{default:n(a=>[a.row.articleId?(d(),w(b,{key:0,to:{name:"articleAndComment",params:{articleId:a.row.articleId}},style:{"text-decoration":"none",color:"#606266","font-size":"13px",display:"flex","align-items":"center"}},{default:n(()=>[o(v,{style:{"margin-right":"4px"}},{default:n(()=>[o(r(O))]),_:1}),m(" "+p(a.row.targetName?`《${a.row.targetName}》`:"文章ID: "+a.row.articleId),1)]),_:2},1032,["to"])):(d(),C("span",Q,"无关联文章"))]),_:1}),o(g,{prop:"created",label:"发布时间",width:"160",align:"center"}),o(g,{label:"操作",width:"100",align:"center"},{default:n(a=>[o(y,{type:"danger",link:"",onClick:S=>E(a.row),icon:r(I)},{default:n(()=>[...e[4]||(e[4]=[m(" 删除 ",-1)])]),_:1},8,["onClick","icon"])]),_:1})]),_:1},8,["data"])]),_:1})]),_:1}),r(t).isFilterMode?z("",!0):(d(),w(x,{key:0,justify:"center",align:"middle",style:{"margin-top":"20px"}},{default:n(()=>[o(h,{span:24,style:{"text-align":"center"}},{default:n(()=>[o($,{"current-page":r(t).pageParams.page,"onUpdate:currentPage":e[0]||(e[0]=a=>r(t).pageParams.page=a),"page-size":r(t).pageParams.rows,"onUpdate:pageSize":e[1]||(e[1]=a=>r(t).pageParams.rows=a),"page-sizes":[5,10,20,50],layout:"total, sizes, prev, pager, next, jumper",total:r(t).pageParams.total,onSizeChange:A,onCurrentChange:D},null,8,["current-page","page-size","total"])]),_:1})]),_:1})),o(R,{modelValue:f.value,"onUpdate:modelValue":e[3]||(e[3]=a=>f.value=a),title:"警告",width:"300px",center:""},{footer:n(()=>[s("span",X,[o(y,{onClick:e[2]||(e[2]=a=>f.value=!1),size:"small"},{default:n(()=>[...e[6]||(e[6]=[m("取消",-1)])]),_:1}),o(y,{type:"danger",onClick:T,size:"small"},{default:n(()=>[...e[7]||(e[7]=[m("确定删除",-1)])]),_:1})])]),default:n(()=>[s("div",W,[o(v,{color:"#F56C6C",size:"24px"},{default:n(()=>[o(r(I))]),_:1}),s("p",null,"确定要删除这条"+p(r(u).type==="REPLY"?"回复":"评论")+"吗？",1),e[5]||(e[5]=s("p",{style:{"font-size":"12px",color:"#999"}},"操作不可恢复",-1))])]),_:1},8,["modelValue"])],64)}}},le=J(Z,[["__scopeId","data-v-c36976b5"]]);export{le as default};
