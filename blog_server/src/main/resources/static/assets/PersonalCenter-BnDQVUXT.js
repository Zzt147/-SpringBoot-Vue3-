import{m as R,r as f,i as W,A as q,b as c,d as e,e as u,w as a,a as o,F as y,p as H,o as n,u as d,t as m,k as _,l as M,M as K,g as Q,J as p}from"./index-BvHamNfy.js";import{T as X}from"./Top-BEXRBFjG.js";import{_ as Y}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Z={class:"center-container"},ee={class:"user-header"},te={class:"username"},ae={class:"reg-time"},se=["onClick"],le={key:1},oe={key:0},ne=["onClick"],re={class:"item-title"},ce={class:"item-date"},ie={key:0},ue={class:"item-content"},me={class:"item-date"},de=["src"],_e={__name:"PersonalCenter",setup(pe){const i=R(),v=H("axios"),T=f("timeline"),b=f([]),k=f([]),x=f([]);f(!1);const r=W({id:"",username:"",name:"",email:"",avatar:""});function E(t,l){t.success?(r.avatar=t.map.url,p.success("头像上传成功，请记得点击“保存修改”按钮！")):p.error("上传失败: "+t.msg)}function N(t){return t.type!=="image/jpeg"&&t.type!=="image/png"?(p.error("头像必须是 JPG 或 PNG 格式!"),!1):t.size/1024/1024>2?(p.error("头像大小不能超过 2MB!"),!1):!0}function U(){if(!i.user.user)return;const t=i.user.user;r.id=t.id,r.username=t.username,r.name=t.name||t.username,r.email=t.email,r.avatar=t.avatar,v.get("/api/oplog/getMyLogs?userId="+t.id).then(l=>{l.data.success&&(b.value=l.data.map.logs)}),v.post("/api/article/getMyArticles?userId="+t.id).then(l=>{l.data.success&&(k.value=l.data.map.articles)}),v.post("/api/comment/getMyComments?username="+t.username).then(l=>{l.data.success&&(x.value=l.data.map.comments)})}function F(){v.post("/api/user/updateInfo",r).then(t=>{t.data.success?(p.success("修改成功"),i.login(t.data.map.user)):p.error(t.data.msg)})}return q(()=>{U()}),(t,l)=>{const P=o("el-affix"),S=o("el-avatar"),w=o("el-card"),I=o("el-col"),$=o("el-timeline-item"),O=o("el-timeline"),C=o("el-empty"),V=o("el-scrollbar"),g=o("el-tab-pane"),j=o("el-icon"),z=o("el-upload"),h=o("el-form-item"),A=o("el-input"),D=o("el-button"),G=o("el-form"),J=o("el-tabs"),L=o("el-row");return n(),c(y,null,[e(P,null,{default:a(()=>[e(X)]),_:1}),u("div",Z,[e(L,{gutter:20},{default:a(()=>[e(I,{xs:24,sm:8},{default:a(()=>[e(w,{class:"box-card",shadow:"hover"},{default:a(()=>[u("div",ee,[e(S,{size:100,src:d(i).user.user?.avatar||"https://cube.elemecdn.com/0/88/03b0d39583f48206768a7534e55bcpng.png"},null,8,["src"]),u("h3",te,m(d(i).user.user?.name||d(i).user.user?.username),1),u("p",ae," 注册于: "+m(d(i).user.user?.created?d(i).user.user.created.replace("T"," "):"未知时间"),1)])]),_:1})]),_:1}),e(I,{xs:24,sm:16},{default:a(()=>[e(w,{shadow:"hover",class:"right-card"},{default:a(()=>[e(J,{modelValue:T.value,"onUpdate:modelValue":l[2]||(l[2]=s=>T.value=s)},{default:a(()=>[e(g,{name:"timeline",label:"我的足迹"},{default:a(()=>[e(V,{"max-height":"500px"},{default:a(()=>[b.value.length>0?(n(),_(O,{key:0,style:{"padding-top":"10px"}},{default:a(()=>[(n(!0),c(y,null,M(b.value,(s,B)=>(n(),_($,{key:B,timestamp:s.created.replace("T"," "),placement:"top",color:s.type==="COMMENT"?"#409EFF":"#909399"},{default:a(()=>[s.targetId&&(s.type==="BROWSE"||s.type==="COMMENT")?(n(),c("span",{key:0,onClick:fe=>t.$router.push("/article_comment/"+s.targetId),style:{cursor:"pointer",color:"#303133"},class:"log-content"},m(s.content),9,se)):(n(),c("span",le,m(s.content),1))]),_:2},1032,["timestamp","color"]))),128))]),_:1})):(n(),_(C,{key:1,description:"暂无足迹"}))]),_:1})]),_:1}),e(g,{name:"articles",label:"我的文章"},{default:a(()=>[e(V,{"max-height":"500px"},{default:a(()=>[k.value.length>0?(n(),c("div",oe,[(n(!0),c(y,null,M(k.value,s=>(n(),c("div",{key:s.id,class:"list-item",onClick:B=>t.$router.push("/article_comment/"+s.id)},[u("span",re,m(s.title),1),u("span",ce,m(s.created.replace("T"," ")),1)],8,ne))),128))])):(n(),_(C,{key:1,description:"你还没发布过文章"}))]),_:1})]),_:1}),e(g,{name:"comments",label:"我的评论"},{default:a(()=>[e(V,{"max-height":"500px"},{default:a(()=>[x.value.length>0?(n(),c("div",ie,[(n(!0),c(y,null,M(x.value,s=>(n(),c("div",{key:s.id,class:"list-item"},[u("span",ue,m(s.content),1),u("span",me,m(s.created.replace("T"," ")),1)]))),128))])):(n(),_(C,{key:1,description:"你还没发表过评论"}))]),_:1})]),_:1}),e(g,{name:"settings",label:"资料设置"},{default:a(()=>[e(G,{"label-width":"80px",style:{"max-width":"500px","margin-top":"20px"}},{default:a(()=>[e(h,{label:"头像"},{default:a(()=>[e(z,{class:"avatar-uploader",action:"/api/file/upload","show-file-list":!1,"on-success":E,"before-upload":N,name:"file"},{default:a(()=>[r.avatar?(n(),c("img",{key:0,src:r.avatar,class:"avatar"},null,8,de)):(n(),_(j,{key:1,class:"avatar-uploader-icon"},{default:a(()=>[e(d(K))]),_:1}))]),_:1})]),_:1}),e(h,{label:"昵称"},{default:a(()=>[e(A,{modelValue:r.name,"onUpdate:modelValue":l[0]||(l[0]=s=>r.name=s)},null,8,["modelValue"])]),_:1}),e(h,{label:"邮箱"},{default:a(()=>[e(A,{modelValue:r.email,"onUpdate:modelValue":l[1]||(l[1]=s=>r.email=s)},null,8,["modelValue"])]),_:1}),e(h,null,{default:a(()=>[e(D,{type:"primary",onClick:F},{default:a(()=>[...l[3]||(l[3]=[Q("保存修改",-1)])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})])],64)}}},ye=Y(_e,[["__scopeId","data-v-25ebdd31"]]);export{ye as default};
