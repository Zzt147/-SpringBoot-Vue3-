import{j as K,P as te,Q as ne,r as I,z as oe,S as ae,T as ie,U as re,V as W,W as $,p as z,i as N,a as E,b as j,o as O,f as U,e as _,d as f,w as p,g as R,u as S,F as Y,m as le,X as G,Y as q,E as L,t as ue,k as se,O as de}from"./index-Kk2cQA5d.js";import{_ as fe}from"./_plugin-vue_export-helper-DlAUqK2U.js";var ce=["onActivate","onAddUndo","onBeforeAddUndo","onBeforeExecCommand","onBeforeGetContent","onBeforeRenderUI","onBeforeSetContent","onBeforePaste","onBlur","onChange","onClearUndos","onClick","onContextMenu","onCopy","onCut","onDblclick","onDeactivate","onDirty","onDrag","onDragDrop","onDragEnd","onDragGesture","onDragOver","onDrop","onExecCommand","onFocus","onFocusIn","onFocusOut","onGetContent","onHide","onInit","onKeyDown","onKeyPress","onKeyUp","onLoadContent","onMouseDown","onMouseEnter","onMouseLeave","onMouseMove","onMouseOut","onMouseOver","onMouseUp","onNodeChange","onObjectResizeStart","onObjectResized","onObjectSelected","onPaste","onPostProcess","onPostRender","onPreProcess","onProgressState","onRedo","onRemove","onReset","onSaveContent","onSelectionChange","onSetAttrib","onSetContent","onShow","onSubmit","onUndo","onVisualAid"],pe=function(e){return ce.map(function(l){return l.toLowerCase()}).indexOf(e.toLowerCase())!==-1},me=function(e,l,i){Object.keys(l).filter(pe).forEach(function(r){var a=l[r];typeof a=="function"&&(r==="onInit"?a(e,i):i.on(r.substring(2),function(c){return a(c,i)}))})},ge=function(e,l,i,r){var a=e.modelEvents?e.modelEvents:null,c=Array.isArray(a)?a.join(" "):a;K(r,function(y,m){i&&typeof y=="string"&&y!==m&&y!==i.getContent({format:e.outputFormat})&&i.setContent(y)}),i.on(c||"change input undo redo",function(){l.emit("update:modelValue",i.getContent({format:e.outputFormat}))})},ve=function(e,l,i,r,a,c){r.setContent(c()),i.attrs["onUpdate:modelValue"]&&ge(l,i,r,a),me(e,i.attrs,r)},X=0,Z=function(e){var l=Date.now(),i=Math.floor(Math.random()*1e9);return X++,e+"_"+i+X+String(l)},ye=function(e){return e!==null&&e.tagName.toLowerCase()==="textarea"},J=function(e){return typeof e>"u"||e===""?[]:Array.isArray(e)?e:e.split(" ")},he=function(e,l){return J(e).concat(J(l))},Ce=function(e){return e==null},Q=function(){return{listeners:[],scriptId:Z("tiny-script"),scriptLoaded:!1}},be=function(){var e=Q(),l=function(a,c,y,m){var t=c.createElement("script");t.referrerPolicy="origin",t.type="application/javascript",t.id=a,t.src=y;var h=function(){t.removeEventListener("load",h),m()};t.addEventListener("load",h),c.head&&c.head.appendChild(t)},i=function(a,c,y){e.scriptLoaded?y():(e.listeners.push(y),a.getElementById(e.scriptId)||l(e.scriptId,a,c,function(){e.listeners.forEach(function(m){return m()}),e.scriptLoaded=!0}))},r=function(){e=Q()};return{load:i,reinitialize:r}},_e=be(),xe=function(){return typeof window<"u"?window:global},D=function(){var e=xe();return e&&e.tinymce?e.tinymce:null},Se={apiKey:String,cloudChannel:String,id:String,init:Object,initialValue:String,inline:Boolean,modelEvents:[String,Array],plugins:[String,Array],tagName:String,toolbar:[String,Array],modelValue:String,disabled:Boolean,tinymceScriptSrc:String,outputFormat:{type:String,validator:function(e){return e==="html"||e==="text"}}},w=function(){return w=Object.assign||function(e){for(var l,i=1,r=arguments.length;i<r;i++){l=arguments[i];for(var a in l)Object.prototype.hasOwnProperty.call(l,a)&&(e[a]=l[a])}return e},w.apply(this,arguments)},we=function(e,l,i,r){return e(r||"div",{id:l,ref:i})},Be=function(e,l,i){return e("textarea",{id:l,visibility:"hidden",ref:i})},F={selector:void 0,target:void 0},Ee=te({props:Se,setup:function(e,l){var i=e.init?w(w({},e.init),F):w({},F),r=ne(e),a=r.disabled,c=r.modelValue,y=r.tagName,m=I(null),t=null,h=e.id||Z("tiny-vue"),k=e.init&&e.init.inline||e.inline,V=!!l.attrs["onUpdate:modelValue"],x=!0,P=e.initialValue?e.initialValue:"",T="",g=function(s){return V?function(){return c?.value?c.value:""}:function(){return s?P:T}},u=function(){var s=g(x),n=w(w({},i),{readonly:e.disabled,target:m.value,plugins:he(i.plugins,e.plugins),toolbar:e.toolbar||i.toolbar,inline:k,setup:function(o){t=o,o.on("init",function(d){return ve(d,e,l,o,c,s)}),typeof i.setup=="function"&&i.setup(o)}});ye(m.value)&&(m.value.style.visibility=""),D().init(n),x=!1};K(a,function(s){var n;t!==null&&(typeof((n=t.mode)===null||n===void 0?void 0:n.set)=="function"?t.mode.set(s?"readonly":"design"):t.setMode(s?"readonly":"design"))}),K(y,function(s){var n;V||(T=t.getContent()),(n=D())===null||n===void 0||n.remove(t),$(function(){return u()})}),oe(function(){if(D()!==null)u();else if(m.value&&m.value.ownerDocument){var s=e.cloudChannel?e.cloudChannel:"6",n=e.apiKey?e.apiKey:"no-api-key",o=Ce(e.tinymceScriptSrc)?"https://cdn.tiny.cloud/1/".concat(n,"/tinymce/").concat(s,"/tinymce.min.js"):e.tinymceScriptSrc;_e.load(m.value.ownerDocument,o,u)}}),ae(function(){D()!==null&&D().remove(t)}),k||(ie(function(){x||u()}),re(function(){var s;V||(T=t.getContent()),(s=D())===null||s===void 0||s.remove(t)}));var C=function(s){var n;T=t.getContent(),(n=D())===null||n===void 0||n.remove(t),i=w(w(w({},i),s),F),$(function(){return u()})};return l.expose({rerender:C,getEditor:function(){return t}}),function(){return k?we(W,h,m,e.tagName):Be(W,h,m)}}});const Te={key:0,id:"fade",class:"black_overlay"},ke={id:"light",class:"white_content"},Ve={class:"test"},De={class:"cropper-control"},Ie={style:{height:"380px","margin-top":"20px"}},Me={key:0,style:{"margin-top":"10px"}},Ae=["src"],Oe=["v-html"],Re={__name:"Cropper",setup(e,{expose:l}){const i=z("axios"),r=N({img:"",fixedBox:!0,canMoveBox:!1,fixedNumber:[373,207],outputSize:1,outputType:"jpeg",autoCrop:!0,autoCropWidth:373,autoCropHeight:207,infoTrue:!0,original:!0,centerBox:!0,enlarge:1}),a=N({file:null,f:null,innerHTML:"",freshCropper:!0,thumbnail:"",isEditor:!1});function c(n){a.file=n.target.files[0];const o={name:a.file.name,size:a.file.size,file:a.file};y(a.file),a.f=o,a.isEditor=!1,document.getElementById("fade").style.display="block",document.getElementById("upload2").value=""}function y(n,o){const d=new FileReader;d.onload=b=>{r.img=b.target.result},d.readAsDataURL(n)}function m(){document.getElementById("fade").style.display="none"}const t=I(null);let h=I(0);function k(n){t.value.getCropData(o=>{let d=V(o,a.file.name),b=new FormData;b.append("file",d.file,d.name);let M={headers:{"Content-Type":"multipart/form-data"}};i.post("/api/article/upload",b,M).then(B=>{if(B.status===200)try{var A=document.getElementById("text");a.thumbnail=B.data.map.url,A.focus();var v=h.value,H=window.getSelection();v&&(H.removeAllRanges(),H.addRange(v)),document.execCommand("InsertImage",!1,a.thumbnail),h.value=H.getRangeAt(0)}catch(ee){console.log("捕获到异常：",ee)}else console.log("失败400")}),document.getElementById("fade").style.display="none"})}function V(n,o){for(var d=n.split(","),b=d[0].match(/:(.*?);/)[1],M=atob(d[1]),B=M.length,A=new Uint8Array(B);B--;)A[B]=M.charCodeAt(B);let v=new Blob([A],{type:b});return v.lastModeifiedDate=new Date,v.name=o,{file:v,name:o}}function x(){var n=window.getSelection();h.value=n.getRangeAt(0)}function P(){t.value.rotateRight()}function T(n){a.innerHTML=n.target.innerHTML}const g=z("freshCropper"),u=()=>a.thumbnail;function C(){a.thumbnail="",g()}function s(n){a.thumbnail=n,a.isEditor=!0}return l({getThumbnail:u,clearData:C,setThumbnail:s}),(n,o)=>{const d=E("VueCropper"),b=E("el-button"),M=E("el-col"),B=E("el-row"),A=E("el-space");return O(),j(Y,null,[a.freshCropper?(O(),j("div",Te,[_("div",ke,[_("div",Ve,[f(d,{ref_key:"myCropper",ref:t,img:r.img,fixedBox:r.fixedBox,canMoveBox:r.canMoveBox,fixedNumber:r.fixedNumber,outputSize:r.size,outputType:r.outputType,infoTrue:r.infoTrue,autoCrop:r.autoCrop,autoCropWidth:r.autoCropWidth,autoCropHeight:r.autoCropHeight,centerBox:r.centerBox,original:r.original,enlarge:r.enlarge},null,8,["img","fixedBox","canMoveBox","fixedNumber","outputSize","outputType","infoTrue","autoCrop","autoCropWidth","autoCropHeight","centerBox","original","enlarge"])]),_("div",De,[f(B,{justify:"end"},{default:p(()=>[f(M,{span:24},{default:p(()=>[o[10]||(o[10]=_("span",{style:{"margin-right":"10px"}},"滚动鼠标滚轮可以缩放图片",-1)),f(b,{type:"primary",onClick:o[0]||(o[0]=v=>m())},{default:p(()=>[...o[7]||(o[7]=[R("取消",-1)])]),_:1}),f(b,{type:"primary",onClick:o[1]||(o[1]=v=>k(v))},{default:p(()=>[...o[8]||(o[8]=[R("确定",-1)])]),_:1}),f(b,{type:"primary",onClick:o[2]||(o[2]=v=>P())},{default:p(()=>[...o[9]||(o[9]=[R("向右边旋转90度",-1)])]),_:1})]),_:1})]),_:1})])])])):U("",!0),_("div",Ie,[f(A,{size:30},{default:p(()=>[o[12]||(o[12]=_("label",{class:"btn-photo",for:"upload2"},"选择文章标题图片(可以不设置，使用默认值)",-1)),_("input",{ref:"upload",type:"file",id:"upload2",style:{position:"absolute",clip:"rect(0 0 0 0)"},accept:"image/png, image/jpeg, image/gif, image/jpg",onChange:o[3]||(o[3]=v=>c(v))},null,544),f(b,{type:"primary",onClick:S(g)},{default:p(()=>[...o[11]||(o[11]=[R("清空图片",-1)])]),_:1},8,["onClick"])]),_:1}),a.isEditor?(O(),j("div",Me,[_("img",{src:a.thumbnail},null,8,Ae)])):U("",!0),a.isEditor?U("",!0):(O(),j("div",{key:1,ref:"cTextareaRef",contenteditable:"true",class:"textdiv",id:"text",onClick:o[4]||(o[4]=v=>x()),onOnkeyup:o[5]||(o[5]=v=>x()),"v-html":a.innerHTML,onBlur:o[6]||(o[6]=v=>T(v))},null,40,Oe))])],64)}}},Pe=fe(Re,[["__scopeId","data-v-cf52aaff"]]),je={id:"editor"},Le={align:"right"},Ne={__name:"PublishArticle",setup(e){const l=le();let i="add";const r=I("发布文章"),a=z("axios"),c=(g,u)=>new Promise((C,s)=>{const n=new XMLHttpRequest;n.withCredentials=!1,n.open("POST","/api/article/upload"),n.upload.onprogress=d=>{u(d.loaded/d.total*100)},n.onload=()=>{if(n.status===403){s({message:"HTTP Error: "+n.status,remove:!0});return}if(n.status<200||n.status>=300){s("HTTP Error: "+n.status);return}const d=JSON.parse(n.response);if(!d||!d.map||typeof d.map.url!="string"){s("Invalid JSON: "+n.responseText);return}C(d.map.url)},n.onerror=()=>{s("Image upload failed due to a XHR Transport error. Code: "+n.status)};const o=new FormData;o.append("file",g.blob(),g.filename()),n.send(o)}),y=I("bdddx89zynvfw2qmzfk2mhycdiss6ujej1hkf49al3p0omcc"),m=N({language:"zh_CN",placeholder:"在这里输入文字",plugins:["image","code"],toolbar:"image",images_file_types:"jpg,jpeg,png,gif,bmp",images_upload_handler:c,convert_urls:!1});let t=N({title:"",tags:"",content:"",thumbnail:""});l.articleId>0&&(i="edit",r.value="编辑文章",a({method:"post",url:"/api/article/selectById?id="+l.articleId}).then(g=>{if(g.data.success){let u=g.data.map.article;t.id=u.id,t.title=u.title,t.tags=u.tags,t.content=u.content,t.thumbnail=u.thumbnail,!G(t.thumbnail)&&!q(t.thumbnail)&&t.thumbnail.indexOf("/api")==0&&h.value.setThumbnail(t.thumbnail)}else L.alert(g.data.msg,"结果");l.articleId=0}).catch(g=>{L.alert("系统错误！","结果"),l.articleId=0}));const h=I(null);function k(){let g=h.value.getThumbnail();G(g)||q(g)||g.indexOf("/api")!=0?t.thumbnail="":t.thumbnail=g,a({method:"post",url:"/api/article/publishArticle?type="+i,data:t,timeout:3e6}).then(u=>{L.alert(u.data,"结果"),u.data=="添加成功！"&&(T(),window.scrollTo(0,0))}).catch(u=>{L.alert("系统错误！","结果")})}const V=z("gotoArticleManage");let x=I(!0);function P(){x.value=!1,$(()=>{x.value=!0})}de("freshCropper",P);function T(){t.title="",t.tags="",t.content="",t.thumbnail="",h.value.clearData()}return(g,u)=>{const C=E("el-col"),s=E("el-row"),n=E("el-input"),o=E("el-button");return O(),j(Y,null,[f(s,null,{default:p(()=>[f(C,{span:24},{default:p(()=>[_("h4",null,ue(r.value),1)]),_:1})]),_:1}),f(s,null,{default:p(()=>[f(C,{span:12},{default:p(()=>[f(n,{modelValue:S(t).title,"onUpdate:modelValue":u[0]||(u[0]=d=>S(t).title=d),placeholder:"请输入文章标题（必须）",clearable:""},null,8,["modelValue"])]),_:1}),f(C,{span:12},{default:p(()=>[f(n,{modelValue:S(t).tags,"onUpdate:modelValue":u[1]||(u[1]=d=>S(t).tags=d),rows:1,type:"textarea",placeholder:"请输入文章标签,可以多行"},null,8,["modelValue"])]),_:1})]),_:1}),f(s,null,{default:p(()=>[f(C,{span:24},{default:p(()=>[_("div",je,[f(S(Ee),{modelValue:S(t).content,"onUpdate:modelValue":u[2]||(u[2]=d=>S(t).content=d),init:m,"api-key":y.value},null,8,["modelValue","init","api-key"])])]),_:1})]),_:1}),f(s,null,{default:p(()=>[f(C,{span:24},{default:p(()=>[S(x)?(O(),se(Pe,{key:0,ref_key:"cropper1",ref:h},null,512)):U("",!0)]),_:1})]),_:1}),f(s,null,{default:p(()=>[f(C,{span:24},{default:p(()=>[_("div",Le,[f(o,{onClick:S(V)},{default:p(()=>[...u[3]||(u[3]=[R("返回列表",-1)])]),_:1},8,["onClick"]),f(o,{type:"primary",onClick:k},{default:p(()=>[...u[4]||(u[4]=[R("保存文章",-1)])]),_:1})])]),_:1})]),_:1})],64)}}};export{Ne as default};
