import{j as K,U as ne,V as oe,r as T,A as Y,W as ae,X as ie,Y as re,Z as W,_ as $,p as N,i as z,a as E,b as R,o as j,f as U,e as S,d,w as v,g as O,u as w,F as Q,m as le,K as ue,$ as q,a0 as G,E as L,t as se,k as de,T as ce}from"./index-DSKI6YI0.js";import{_ as fe}from"./_plugin-vue_export-helper-DlAUqK2U.js";var pe=["onActivate","onAddUndo","onBeforeAddUndo","onBeforeExecCommand","onBeforeGetContent","onBeforeRenderUI","onBeforeSetContent","onBeforePaste","onBlur","onChange","onClearUndos","onClick","onContextMenu","onCopy","onCut","onDblclick","onDeactivate","onDirty","onDrag","onDragDrop","onDragEnd","onDragGesture","onDragOver","onDrop","onExecCommand","onFocus","onFocusIn","onFocusOut","onGetContent","onHide","onInit","onKeyDown","onKeyPress","onKeyUp","onLoadContent","onMouseDown","onMouseEnter","onMouseLeave","onMouseMove","onMouseOut","onMouseOver","onMouseUp","onNodeChange","onObjectResizeStart","onObjectResized","onObjectSelected","onPaste","onPostProcess","onPostRender","onPreProcess","onProgressState","onRedo","onRemove","onReset","onSaveContent","onSelectionChange","onSetAttrib","onSetContent","onShow","onSubmit","onUndo","onVisualAid"],me=function(e){return pe.map(function(l){return l.toLowerCase()}).indexOf(e.toLowerCase())!==-1},ge=function(e,l,i){Object.keys(l).filter(me).forEach(function(a){var o=l[a];typeof o=="function"&&(a==="onInit"?o(e,i):i.on(a.substring(2),function(g){return o(g,i)}))})},ve=function(e,l,i,a){var o=e.modelEvents?e.modelEvents:null,g=Array.isArray(o)?o.join(" "):o;K(a,function(C,c){i&&typeof C=="string"&&C!==c&&C!==i.getContent({format:e.outputFormat})&&i.setContent(C)}),i.on(g||"change input undo redo",function(){l.emit("update:modelValue",i.getContent({format:e.outputFormat}))})},ye=function(e,l,i,a,o,g){a.setContent(g()),i.attrs["onUpdate:modelValue"]&&ve(l,i,a,o),ge(e,i.attrs,a)},J=0,ee=function(e){var l=Date.now(),i=Math.floor(Math.random()*1e9);return J++,e+"_"+i+J+String(l)},he=function(e){return e!==null&&e.tagName.toLowerCase()==="textarea"},X=function(e){return typeof e>"u"||e===""?[]:Array.isArray(e)?e:e.split(" ")},Ce=function(e,l){return X(e).concat(X(l))},be=function(e){return e==null},Z=function(){return{listeners:[],scriptId:ee("tiny-script"),scriptLoaded:!1}},_e=function(){var e=Z(),l=function(o,g,C,c){var u=g.createElement("script");u.referrerPolicy="origin",u.type="application/javascript",u.id=o,u.src=C;var _=function(){u.removeEventListener("load",_),c()};u.addEventListener("load",_),g.head&&g.head.appendChild(u)},i=function(o,g,C){e.scriptLoaded?C():(e.listeners.push(C),o.getElementById(e.scriptId)||l(e.scriptId,o,g,function(){e.listeners.forEach(function(c){return c()}),e.scriptLoaded=!0}))},a=function(){e=Z()};return{load:i,reinitialize:a}},xe=_e(),Se=function(){return typeof window<"u"?window:global},A=function(){var e=Se();return e&&e.tinymce?e.tinymce:null},we={apiKey:String,cloudChannel:String,id:String,init:Object,initialValue:String,inline:Boolean,modelEvents:[String,Array],plugins:[String,Array],tagName:String,toolbar:[String,Array],modelValue:String,disabled:Boolean,tinymceScriptSrc:String,outputFormat:{type:String,validator:function(e){return e==="html"||e==="text"}}},B=function(){return B=Object.assign||function(e){for(var l,i=1,a=arguments.length;i<a;i++){l=arguments[i];for(var o in l)Object.prototype.hasOwnProperty.call(l,o)&&(e[o]=l[o])}return e},B.apply(this,arguments)},Be=function(e,l,i,a){return e(a||"div",{id:l,ref:i})},Ee=function(e,l,i){return e("textarea",{id:l,visibility:"hidden",ref:i})},F={selector:void 0,target:void 0},Te=ne({props:we,setup:function(e,l){var i=e.init?B(B({},e.init),F):B({},F),a=oe(e),o=a.disabled,g=a.modelValue,C=a.tagName,c=T(null),u=null,_=e.id||ee("tiny-vue"),D=e.init&&e.init.inline||e.inline,I=!!l.attrs["onUpdate:modelValue"],r=!0,V=e.initialValue?e.initialValue:"",k="",M=function(y){return I?function(){return g?.value?g.value:""}:function(){return y?V:k}},x=function(){var y=M(r),n=B(B({},i),{readonly:e.disabled,target:c.value,plugins:Ce(i.plugins,e.plugins),toolbar:e.toolbar||i.toolbar,inline:D,setup:function(t){u=t,t.on("init",function(f){return ye(f,e,l,t,g,y)}),typeof i.setup=="function"&&i.setup(t)}});he(c.value)&&(c.value.style.visibility=""),A().init(n),r=!1};K(o,function(y){var n;u!==null&&(typeof((n=u.mode)===null||n===void 0?void 0:n.set)=="function"?u.mode.set(y?"readonly":"design"):u.setMode(y?"readonly":"design"))}),K(C,function(y){var n;I||(k=u.getContent()),(n=A())===null||n===void 0||n.remove(u),$(function(){return x()})}),Y(function(){if(A()!==null)x();else if(c.value&&c.value.ownerDocument){var y=e.cloudChannel?e.cloudChannel:"6",n=e.apiKey?e.apiKey:"no-api-key",t=be(e.tinymceScriptSrc)?"https://cdn.tiny.cloud/1/".concat(n,"/tinymce/").concat(y,"/tinymce.min.js"):e.tinymceScriptSrc;xe.load(c.value.ownerDocument,t,x)}}),ae(function(){A()!==null&&A().remove(u)}),D||(ie(function(){r||x()}),re(function(){var y;I||(k=u.getContent()),(y=A())===null||y===void 0||y.remove(u)}));var P=function(y){var n;k=u.getContent(),(n=A())===null||n===void 0||n.remove(u),i=B(B(B({},i),y),F),$(function(){return x()})};return l.expose({rerender:P,getEditor:function(){return u}}),function(){return D?Be(W,_,c,e.tagName):Ee(W,_,c)}}});const Ve={key:0,id:"fade",class:"black_overlay"},ke={id:"light",class:"white_content"},De={class:"test"},Ie={class:"cropper-control"},Ae={style:{height:"380px","margin-top":"20px"}},Me={key:0,style:{"margin-top":"10px"}},je=["src"],Oe=["v-html"],Pe={__name:"Cropper",setup(e,{expose:l}){const i=N("axios"),a=z({img:"",fixedBox:!0,canMoveBox:!1,fixedNumber:[373,207],outputSize:1,outputType:"jpeg",autoCrop:!0,autoCropWidth:373,autoCropHeight:207,infoTrue:!0,original:!0,centerBox:!0,enlarge:1}),o=z({file:null,f:null,innerHTML:"",freshCropper:!0,thumbnail:"",isEditor:!1});function g(n){o.file=n.target.files[0];const t={name:o.file.name,size:o.file.size,file:o.file};C(o.file),o.f=t,o.isEditor=!1,document.getElementById("fade").style.display="block",document.getElementById("upload2").value=""}function C(n,t){const f=new FileReader;f.onload=s=>{a.img=s.target.result},f.readAsDataURL(n)}function c(){document.getElementById("fade").style.display="none"}const u=T(null);let _=T(0);function D(n){u.value.getCropData(t=>{let f=I(t,o.file.name),s=new FormData;s.append("file",f.file,f.name);let p={headers:{"Content-Type":"multipart/form-data"}};i.post("/api/article/upload",s,p).then(b=>{if(b.status===200)try{var h=document.getElementById("text");o.thumbnail=b.data.map.url,h.focus();var m=_.value,H=window.getSelection();m&&(H.removeAllRanges(),H.addRange(m)),document.execCommand("InsertImage",!1,o.thumbnail),_.value=H.getRangeAt(0)}catch(te){console.log("捕获到异常：",te)}else console.log("失败400")}),document.getElementById("fade").style.display="none"})}function I(n,t){for(var f=n.split(","),s=f[0].match(/:(.*?);/)[1],p=atob(f[1]),b=p.length,h=new Uint8Array(b);b--;)h[b]=p.charCodeAt(b);let m=new Blob([h],{type:s});return m.lastModeifiedDate=new Date,m.name=t,{file:m,name:t}}function r(){var n=window.getSelection();_.value=n.getRangeAt(0)}function V(){u.value.rotateRight()}function k(n){o.innerHTML=n.target.innerHTML}const M=N("freshCropper"),x=()=>o.thumbnail;function P(){o.thumbnail="",M()}function y(n){o.thumbnail=n,o.isEditor=!0}return l({getThumbnail:x,clearData:P,setThumbnail:y}),(n,t)=>{const f=E("VueCropper"),s=E("el-button"),p=E("el-col"),b=E("el-row"),h=E("el-space");return j(),R(Q,null,[o.freshCropper?(j(),R("div",Ve,[S("div",ke,[S("div",De,[d(f,{ref_key:"myCropper",ref:u,img:a.img,fixedBox:a.fixedBox,canMoveBox:a.canMoveBox,fixedNumber:a.fixedNumber,outputSize:a.size,outputType:a.outputType,infoTrue:a.infoTrue,autoCrop:a.autoCrop,autoCropWidth:a.autoCropWidth,autoCropHeight:a.autoCropHeight,centerBox:a.centerBox,original:a.original,enlarge:a.enlarge},null,8,["img","fixedBox","canMoveBox","fixedNumber","outputSize","outputType","infoTrue","autoCrop","autoCropWidth","autoCropHeight","centerBox","original","enlarge"])]),S("div",Ie,[d(b,{justify:"end"},{default:v(()=>[d(p,{span:24},{default:v(()=>[t[10]||(t[10]=S("span",{style:{"margin-right":"10px"}},"滚动鼠标滚轮可以缩放图片",-1)),d(s,{type:"primary",onClick:t[0]||(t[0]=m=>c())},{default:v(()=>[...t[7]||(t[7]=[O("取消",-1)])]),_:1}),d(s,{type:"primary",onClick:t[1]||(t[1]=m=>D(m))},{default:v(()=>[...t[8]||(t[8]=[O("确定",-1)])]),_:1}),d(s,{type:"primary",onClick:t[2]||(t[2]=m=>V())},{default:v(()=>[...t[9]||(t[9]=[O("向右边旋转90度",-1)])]),_:1})]),_:1})]),_:1})])])])):U("",!0),S("div",Ae,[d(h,{size:30},{default:v(()=>[t[12]||(t[12]=S("label",{class:"btn-photo",for:"upload2"},"选择文章标题图片(可以不设置，使用默认值)",-1)),S("input",{ref:"upload",type:"file",id:"upload2",style:{position:"absolute",clip:"rect(0 0 0 0)"},accept:"image/png, image/jpeg, image/gif, image/jpg",onChange:t[3]||(t[3]=m=>g(m))},null,544),d(s,{type:"primary",onClick:w(M)},{default:v(()=>[...t[11]||(t[11]=[O("清空图片",-1)])]),_:1},8,["onClick"])]),_:1}),o.isEditor?(j(),R("div",Me,[S("img",{src:o.thumbnail},null,8,je)])):U("",!0),o.isEditor?U("",!0):(j(),R("div",{key:1,ref:"cTextareaRef",contenteditable:"true",class:"textdiv",id:"text",onClick:t[4]||(t[4]=m=>r()),onOnkeyup:t[5]||(t[5]=m=>r()),"v-html":o.innerHTML,onBlur:t[6]||(t[6]=m=>k(m))},null,40,Oe))])],64)}}},Re=fe(Pe,[["__scopeId","data-v-cf52aaff"]]),Le={id:"editor"},Ue={align:"right"},He={__name:"PublishArticle",setup(e){const l=le(),i=ue(),a=N("axios");let o="add";const g=T("发布文章"),C=T([]),c=T([]);function u(){a.get("/api/category/getTree").then(n=>{n.data.success&&(C.value=n.data.map.data)})}const _=(n,t)=>new Promise((f,s)=>{const p=new XMLHttpRequest;p.withCredentials=!1,p.open("POST","/api/article/upload"),p.upload.onprogress=h=>{t(h.loaded/h.total*100)},p.onload=()=>{if(p.status===403){s({message:"HTTP Error: "+p.status,remove:!0});return}if(p.status<200||p.status>=300){s("HTTP Error: "+p.status);return}const h=JSON.parse(p.response);if(!h||!h.map||typeof h.map.url!="string"){s("Invalid JSON: "+p.responseText);return}f(h.map.url)},p.onerror=()=>{s("Image upload failed. Code: "+p.status)};const b=new FormData;b.append("file",n.blob(),n.filename()),p.send(b)}),D=T("bdddx89zynvfw2qmzfk2mhycdiss6ujej1hkf49al3p0omcc"),I=z({language:"zh_CN",placeholder:"在这里输入文字",plugins:["image","code"],toolbar:"image",images_file_types:"jpg,jpeg,png,gif,bmp",images_upload_handler:_,convert_urls:!1});let r=z({title:"",tags:"",content:"",categories:"",thumbnail:""});const V=T(null);function k(){let n=V.value.getThumbnail();if(q(n)||G(n)||n.indexOf("/api")!=0?r.thumbnail="":r.thumbnail=n,c.value&&c.value.length>0?r.categories=c.value.join("/"):r.categories="默认分类",r.tags){let f=r.tags.replace(/，/g," ").replace(/,/g," ").trim().split(/\s+/);r.tags=f.map(s=>s.startsWith("#")?s:"#"+s).join(" ")}a({method:"post",url:"/api/article/publishArticle?type="+o,data:r,timeout:3e6}).then(t=>{L.alert(t.data,"结果"),t.data=="添加成功！"&&(y(),window.scrollTo(0,0))}).catch(t=>{L.alert("系统错误！","结果")})}const M=N("gotoArticleManage");let x=T(!0);function P(){x.value=!1,$(()=>{x.value=!0})}ce("freshCropper",P);function y(){r.title="",r.tags="",r.content="",r.categories="",c.value=[],r.thumbnail="",V.value.clearData()}return Y(()=>{if(u(),i.query.categoryPath){const n=i.query.categoryPath;c.value=n.split("/"),r.categories=n}l.articleId>0&&(o="edit",g.value="编辑文章",a({method:"post",url:"/api/article/selectById?id="+l.articleId}).then(n=>{if(n.data.success){let t=n.data.map.article;r.id=t.id,r.title=t.title,r.tags=t.tags,r.content=t.content,r.thumbnail=t.thumbnail,t.categories&&(r.categories=t.categories,c.value=t.categories.split("/")),!q(r.thumbnail)&&!G(r.thumbnail)&&r.thumbnail.indexOf("/api")==0&&V.value.setThumbnail(r.thumbnail)}else L.alert(n.data.msg,"结果");l.articleId=0}).catch(n=>{L.alert("系统错误！","结果"),l.articleId=0}))}),(n,t)=>{const f=E("el-col"),s=E("el-row"),p=E("el-input"),b=E("el-cascader"),h=E("el-button");return j(),R(Q,null,[d(s,null,{default:v(()=>[d(f,{span:24},{default:v(()=>[S("h4",null,se(g.value),1)]),_:1})]),_:1}),d(s,{gutter:20,style:{"margin-bottom":"20px"}},{default:v(()=>[d(f,{span:8},{default:v(()=>[d(p,{modelValue:w(r).title,"onUpdate:modelValue":t[0]||(t[0]=m=>w(r).title=m),placeholder:"请输入文章标题（必须）",clearable:""},null,8,["modelValue"])]),_:1}),d(f,{span:8},{default:v(()=>[d(b,{modelValue:c.value,"onUpdate:modelValue":t[1]||(t[1]=m=>c.value=m),options:C.value,props:{checkStrictly:!0,value:"name",label:"name"},placeholder:"请选择文章分类",clearable:"",style:{width:"100%"}},null,8,["modelValue","options"])]),_:1}),d(f,{span:8},{default:v(()=>[d(p,{modelValue:w(r).tags,"onUpdate:modelValue":t[2]||(t[2]=m=>w(r).tags=m),placeholder:"标签: #Java #Spring (空格隔开)",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),d(s,null,{default:v(()=>[d(f,{span:24},{default:v(()=>[S("div",Le,[d(w(Te),{modelValue:w(r).content,"onUpdate:modelValue":t[3]||(t[3]=m=>w(r).content=m),init:I,"api-key":D.value},null,8,["modelValue","init","api-key"])])]),_:1})]),_:1}),d(s,null,{default:v(()=>[d(f,{span:24},{default:v(()=>[w(x)?(j(),de(Re,{key:0,ref_key:"cropper1",ref:V},null,512)):U("",!0)]),_:1})]),_:1}),d(s,null,{default:v(()=>[d(f,{span:24},{default:v(()=>[S("div",Ue,[d(h,{onClick:w(M)},{default:v(()=>[...t[4]||(t[4]=[O("返回列表",-1)])]),_:1},8,["onClick"]),d(h,{type:"primary",onClick:k},{default:v(()=>[...t[5]||(t[5]=[O("保存文章",-1)])]),_:1})])]),_:1})]),_:1})],64)}}};export{He as default};
