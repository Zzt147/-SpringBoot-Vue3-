import{r as u,A as ce,i as _e,m as me,b as m,d as t,w as l,a as d,p as pe,y as fe,B as ve,o as c,H as j,e as o,u as _,M as z,g as p,k as A,a5 as H,t as h,a6 as J,a1 as K,f as G,a7 as ge,a8 as ke,F as O,l as Q,a2 as ye,a4 as he,J as b,E as be}from"./index-DSKI6YI0.js";import{_ as Ce}from"./_plugin-vue_export-helper-DlAUqK2U.js";const xe={class:"category-manage"},Ve={class:"panel-header"},Ie={class:"custom-tree-node"},we={class:"node-label"},$e={class:"node-actions"},Be={key:0,class:"content-header"},Me={class:"path-info"},Ne={class:"path-text"},Re={class:"header-actions"},De={key:2,class:"resource-list"},Fe=["onDblclick"],Le={class:"item-icon folder-icon"},Pe={class:"item-info"},Ee={class:"item-name"},ze={class:"item-actions"},Ae={class:"item-icon article-icon"},Te={class:"item-info"},Ue=["title"],qe={class:"item-meta"},Se={class:"item-actions"},je={key:0,class:"empty-tip"},He={__name:"ManageCategory",setup(Je){const g=pe("axios"),W=fe(),B=u([]),M=u(!1),N=u(!1),r=u(null),R=u(""),D=u([]),F=u([]);function C(){M.value=!0,g.get("/api/category/getTree").then(a=>{a.data.success&&(B.value=a.data.map.data||[]),M.value=!1})}ce(()=>{C()});function X(a){r.value=a,x(a.id)}function x(a){N.value=!0,g.get("/api/category/getResources?id="+a).then(e=>{if(e.data.success){const s=e.data.map.data;D.value=s.folders||[],F.value=s.articles||[],R.value=s.currentPath}N.value=!1})}function Y(a){r.value=a,x(a.id),I.value&&(I.value.setCurrentKey(a.id),I.value.expandNode(a.id))}function Z(){r.value&&W.push({name:"publishArticle",query:{categoryPath:R.value}})}const k=u(!1),V=u(""),T=u(null),i=_e({id:null,name:"",parentId:0,sort:0}),ee={name:[{required:!0,message:"è¯·è¾“å…¥åç§°",trigger:"blur"}]};function y(a,e){k.value=!0,i.id=null,i.name="",i.sort=0,a==="add_root"?(V.value="æ–°å¢žé¡¶çº§åˆ†ç±»",i.parentId=0):a==="add_sub"?(V.value=`åœ¨ [${e.name}] ä¸‹æ–°å¢ž`,i.parentId=e.id):a==="edit"&&(V.value="ç¼–è¾‘åˆ†ç±»",i.id=e.id,i.name=e.name,i.parentId=e.parentId,i.sort=e.sort)}function te(){T.value.validate(a=>{if(a){const e=i.id?"/api/category/update":"/api/category/add";g.post(e,i).then(s=>{s.data.success?(b.success(s.data.msg),k.value=!1,C(),r.value&&x(r.value.id)):b.error(s.data.msg)})}})}function ae(a){be.confirm(`ç¡®å®šåˆ é™¤ [${a.name}] ?`,"è­¦å‘Š",{type:"warning"}).then(()=>{g.post("/api/category/delete?id="+a.id).then(e=>{e.data.success?(b.success("åˆ é™¤æˆåŠŸ"),C(),r.value&&r.value.id===a.parentId&&x(a.parentId)):b.error(e.data.msg)})})}const le=(a,e,s,f)=>{let L=s==="inner"?e.data.id:e.data.parentId;const w=s==="inner"?e:e.parent,P=(w.level===0?B.value:w.data.children||[]).map((v,E)=>({id:v.id,parentId:L,name:v.name,sort:E+1}));g.post("/api/category/updateBatch",P).then(v=>{v.data.success?b.success("æŽ’åºå·²æ›´æ–°"):C()})},ne={children:"children",label:"name"},I=u(null);return me(),(a,e)=>{const s=d("el-button"),f=d("el-icon"),L=d("el-tree"),w=d("el-scrollbar"),U=d("el-aside"),P=d("el-empty"),v=d("el-tag"),E=d("el-main"),se=d("el-container"),oe=d("el-card"),ie=d("el-input"),q=d("el-form-item"),de=d("el-input-number"),re=d("el-form"),ue=d("el-dialog"),S=ve("loading");return c(),m("div",xe,[t(oe,{shadow:"never",class:"main-card"},{default:l(()=>[t(se,{style:{height:"600px"}},{default:l(()=>[t(U,{width:"280px",class:"left-panel"},{default:l(()=>[o("div",Ve,[e[7]||(e[7]=o("span",null,"ðŸ“š ç›®å½•ç»“æž„",-1)),t(s,{link:"",type:"primary",icon:_(z),onClick:e[0]||(e[0]=n=>y("add_root"))},{default:l(()=>[...e[6]||(e[6]=[p("æ–°å»ºæ ¹ç›®å½•",-1)])]),_:1},8,["icon"])]),t(w,null,{default:l(()=>[j((c(),A(L,{ref_key:"treeRef",ref:I,data:B.value,"node-key":"id","default-expand-all":"",draggable:"","expand-on-click-node":!1,props:ne,"highlight-current":"",onNodeClick:X,onNodeDrop:le},{default:l(({data:n})=>[o("div",Ie,[o("span",we,[t(f,{class:"icon-folder"},{default:l(()=>[t(_(H))]),_:1}),p(" "+h(n.name),1)]),o("span",$e,[t(f,{onClick:J($=>y("add_sub",n),["stop"]),title:"æ–°å¢žå­çº§"},{default:l(()=>[t(_(z))]),_:1},8,["onClick"]),t(f,{onClick:J($=>y("edit",n),["stop"]),title:"ç¼–è¾‘"},{default:l(()=>[t(_(K))]),_:1},8,["onClick"])])])]),_:1},8,["data"])),[[S,M.value]])]),_:1})]),_:1}),j((c(),A(E,{class:"right-panel"},{default:l(()=>[r.value?(c(),m("div",Be,[o("div",Me,[t(f,null,{default:l(()=>[t(_(ge))]),_:1}),o("span",Ne,h(R.value||r.value.name),1)]),o("div",Re,[t(s,{type:"success",size:"small",icon:_(ke),onClick:Z},{default:l(()=>[...e[8]||(e[8]=[p("æ–°å»ºæ–‡ç« ",-1)])]),_:1},8,["icon"]),t(s,{type:"primary",size:"small",icon:_(z),onClick:e[1]||(e[1]=n=>y("add_sub",r.value))},{default:l(()=>[...e[9]||(e[9]=[p("æ–°å»ºæ–‡ä»¶å¤¹",-1)])]),_:1},8,["icon"])])])):(c(),A(P,{key:1,description:"è¯·é€‰æ‹©å·¦ä¾§åˆ†ç±»æŸ¥çœ‹å†…å®¹"})),r.value?(c(),m("div",De,[(c(!0),m(O,null,Q(D.value,n=>(c(),m("div",{key:"folder-"+n.id,class:"resource-item folder-item",onDblclick:$=>Y(n)},[o("div",Le,[t(f,null,{default:l(()=>[t(_(H))]),_:1})]),o("div",Pe,[o("div",Ee,h(n.name),1),e[10]||(e[10]=o("div",{class:"item-meta"},"å­åˆ†ç±»",-1))]),o("div",ze,[t(s,{link:"",icon:_(K),onClick:$=>y("edit",n)},{default:l(()=>[...e[11]||(e[11]=[p("é‡å‘½å",-1)])]),_:1},8,["icon","onClick"]),t(s,{link:"",type:"danger",icon:_(ye),onClick:$=>ae(n)},null,8,["icon","onClick"])])],40,Fe))),128)),(c(!0),m(O,null,Q(F.value,n=>(c(),m("div",{key:"article-"+n.id,class:"resource-item article-item"},[o("div",Ae,[t(f,null,{default:l(()=>[t(_(he))]),_:1})]),o("div",Te,[o("div",{class:"item-name",title:n.title},h(n.title),9,Ue),o("div",qe,h(n.created),1)]),o("div",Se,[t(v,{size:"small"},{default:l(()=>[...e[12]||(e[12]=[p("æ–‡ç« ",-1)])]),_:1})])]))),128)),D.value.length===0&&F.value.length===0?(c(),m("div",je," æ­¤æ–‡ä»¶å¤¹ä¸ºç©º ")):G("",!0)])):G("",!0)]),_:1})),[[S,N.value]])]),_:1})]),_:1}),t(ue,{modelValue:k.value,"onUpdate:modelValue":e[5]||(e[5]=n=>k.value=n),title:V.value,width:"400px"},{footer:l(()=>[t(s,{onClick:e[4]||(e[4]=n=>k.value=!1)},{default:l(()=>[...e[13]||(e[13]=[p("å–æ¶ˆ",-1)])]),_:1}),t(s,{type:"primary",onClick:te},{default:l(()=>[...e[14]||(e[14]=[p("ç¡®å®š",-1)])]),_:1})]),default:l(()=>[t(re,{model:i,rules:ee,ref_key:"formRef",ref:T,"label-width":"80px"},{default:l(()=>[t(q,{label:"åç§°",prop:"name"},{default:l(()=>[t(ie,{modelValue:i.name,"onUpdate:modelValue":e[2]||(e[2]=n=>i.name=n)},null,8,["modelValue"])]),_:1}),t(q,{label:"æŽ’åº",prop:"sort"},{default:l(()=>[t(de,{modelValue:i.sort,"onUpdate:modelValue":e[3]||(e[3]=n=>i.sort=n)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},Oe=Ce(He,[["__scopeId","data-v-769cf15d"]]);export{Oe as default};
